package com.revshop.service;
import java.sql.ResultSet;

import com.revshop.dao.UserDAO;

public class UserService {

    UserDAO userDAO = new UserDAO();

    public boolean register(String name, String email, String password, String role ) {
        return userDAO.register(name, email, password, role);
    }


    public boolean changePassword(String email, String newPwd) {
        return userDAO.changePassword(email, newPwd);
    }
        public String login(String email, String password) {
            return userDAO.loginAndGetRole(email, password);
        }
     // File: com/revshop/service/UserService.java

        public int loginAndGetUserId(String email, String password) {
            int userId = -1;
            String sql = "SELECT user_id, role FROM users WHERE email=? AND password=?";
            try (Connection con = DBConnection.getConnection();
                 PreparedStatement ps = con.prepareStatement(sql)) {
                ps.setString(1, email);
                ps.setString(2, password);
                try (ResultSet rs = ps.executeQuery()) {
                    if (rs.next()) {
                        userId = rs.getInt("user_id");
                    }
                }
            } catch (SQLException e) {
                e.printStackTrace();
            }
            return userId;
        }

        public String loginAndGetRole(String email, String password) {
            String role = null;
            String sql = "SELECT role FROM users WHERE email=? AND password=?";
            try (Connection con = DBConnection.getConnection();
                 PreparedStatement ps = con.prepareStatement(sql)) {
                ps.setString(1, email);
                ps.setString(2, password);
                try (ResultSet rs = ps.executeQuery()) {
                    if (rs.next()) {
                        role = rs.getString("role");
                    }
                }
            } catch (SQLException e) {
                e.printStackTrace();
            }
            return role;
        }

        
//        public int loginAndGetUserId(String email, String password) {
//            try {
//                ResultSet rs = userDAO.loginAndGetUser(email, password);
//                if (rs != null && rs.next()) {
//                    return rs.getInt("user_id");
//                }
//            } catch (Exception e) {
//                e.printStackTrace();
//            }
//            return -1;
//        }
//
//        public String loginAndGetRole(String email, String password) {
//            try {
//                ResultSet rs = userDAO.loginAndGetUser(email, password);
//                if (rs != null && rs.next()) {
//                    return rs.getString("role");
//                }
//            } catch (Exception e) {
//                e.printStackTrace();
//            }
//            return null;
//        }

    
}
