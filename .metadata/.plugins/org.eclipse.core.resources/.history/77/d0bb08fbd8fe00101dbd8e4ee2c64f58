package com.revshop.service;

import java.sql.SQLException;
import java.util.Scanner;

import org.apache.log4j.Logger;

import com.revshop.dao.PaymentDAO;

public class PaymentService {

    private static final Logger logger = Logger.getLogger(PaymentService.class);

    private PaymentDAO dao = new PaymentDAO();
    private Scanner sc = new Scanner(System.in);

    public void makePayment(int userId) throws SQLException {

        int orderId = dao.getLatestOrderId(userId);

        if (orderId == 0) {
            logger.warn("No orders found for payment. UserId: " + userId);
            return;
        }

        logger.info("Payment started for UserId: " + userId + ", OrderId: " + orderId);
        logger.info("1. Credit/Debit Card");
        logger.info("2. UPI");
        logger.info("3. Cash on Delivery");

        int choice = Integer.parseInt(sc.nextLine());
        String method = "";

        switch (choice) {

            case 1:
                method = "CARD";
                logger.info("Card payment selected for OrderId: " + orderId);
                sc.nextLine(); // consume input
                logger.info("Processing card payment");
                break;

            case 2:
                method = "UPI";
                logger.info("UPI payment selected for OrderId: " + orderId);
                sc.nextLine(); // consume input
                logger.info("Processing UPI payment");
                break;

            case 3:
                method = "COD";
                logger.info("Cash on Delivery selected for OrderId: " + orderId);
                break;

            default:
                logger.warn("Invalid payment option selected by UserId: " + userId);
                return;
        }

        dao.updatePayment(orderId, method);

        logger.info("Payment successful. OrderId: " + orderId + ", Method: " + method);
        logger.info("Order marked as PAID. OrderId: " + orderId);
    }
}
