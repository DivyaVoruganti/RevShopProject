package com.revshop.dao;

import com.revshop.model.Product;
import java.sql.*;
import com.revshop.util.DBConnection;
public class ProductDAO {

	public void viewAllProducts() {
		try {
			Connection con = DBConnection.getConnection();
			Statement st = con.createStatement();
			ResultSet rs = st.executeQuery("SELECT * FROM products");
			System.out.println("ID\tName\tPrice\tStock\tCategory");
			while (rs.next()) {
				System.out.println(rs.getInt("product_id") + "\t"
						+ rs.getString("name") + "\t" + rs.getDouble("price")
						+ "\t" + rs.getInt("stock") + "\t"
						+ rs.getString("category"));
			}
			con.close();
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
	public void addProduct(Product product) {

        String sql = "INSERT INTO products "
                   + "(seller_id, name, price, stock, category, description) "
                   + "VALUES (?, ?, ?, ?, ?, ?)";

        try (Connection con = DBConnection.getConnection();
             PreparedStatement ps = con.prepareStatement(sql)) {

            ps.setInt(1, product.getSellerId());
            ps.setString(2, product.getName());
            ps.setDouble(3, product.getPrice());
            ps.setInt(4, product.getStock());
            ps.setString(5, product.getCategory());
            ps.setString(6, product.getDescription());

            ps.executeUpdate();

        } catch (SQLException e) {
            e.printStackTrace();
        }
    }

	public void searchProducts(String keyword) {
        String sql = "SELECT * FROM products WHERE LOWER(name) LIKE LOWER(?)";
        Connection con = null;
        PreparedStatement ps = null;
        ResultSet rs = null;

        try { con = DBConnection.getConnection();
             ps = con.prepareStatement(sql); 

            ps.setString(1, "%" + keyword + "%");
             rs = ps.executeQuery();

            boolean found = false;
            while (rs.next()) {
                found = true;
                System.out.println(
                    rs.getInt("product_id") + " | " +
                    rs.getString("name") + " | " +
                    rs.getString("category") + " | " +
                    rs.getDouble("price")
                );
            }

            if (!found) {
                System.out.println("No matching products found.");
            }
        
        }
    catch (Exception e) {
            e.printStackTrace();
    }finally{
    	try{
    		if (rs != null) rs.close();
            if (ps != null) ps.close();
            if (con != null) con.close();
    	}catch(Exception e){
    		 e.printStackTrace();
    	}
    }
        
    }
}
