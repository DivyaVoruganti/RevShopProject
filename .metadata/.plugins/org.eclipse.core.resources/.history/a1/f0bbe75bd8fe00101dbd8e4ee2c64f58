package com.revshop.dao;
import java.sql.*;
import com.revshop.util.DBConnection;
public class OrderDAO {
	 public void viewOrderHistory(int userId) throws SQLException {
	        Connection con = DBConnection.getConnection();

	        String sql =
	            "SELECT o.order_id, o.order_date, o.total_amount " +
	            "FROM orders o " +
	            "WHERE o.user_id = ? " +
	            "ORDER BY o.order_date DESC";

	        PreparedStatement ps = con.prepareStatement(sql);
	        ps.setInt(1, userId);
	        ResultSet rs = ps.executeQuery();

	        System.out.println("\n===== ORDER HISTORY =====");
	        System.out.println("Order ID | Date | Total");

	        while (rs.next()) {
	            System.out.println(
	                rs.getInt("order_id") + " | " +
	                rs.getDate("order_date") + " | " +
	                rs.getDouble("total_amount")
	            );

	            viewOrderItems(rs.getInt("order_id"), con);
	        }

	        rs.close();
	        ps.close();
	        con.close();
	    }

	    private void viewOrderItems(int orderId, Connection con) throws SQLException {
	        String sql =
	            "SELECT p.name, oi.quantity, oi.price " +
	            "FROM order_items oi " +
	            "JOIN products p ON oi.product_id = p.product_id " +
	            "WHERE oi.order_id = ?";

	        PreparedStatement ps = con.prepareStatement(sql);
	        ps.setInt(1, orderId);
	        ResultSet rs = ps.executeQuery();

	        while (rs.next()) {
	            System.out.println(
	                "   - " + rs.getString("name") +
	                " | Qty: " + rs.getInt("quantity") +
	                " | Price: " + rs.getDouble("price")
	            );
	        }

	        rs.close();
	        ps.close();
	    }
	    public void viewOrdersBySeller(int sellerId) throws SQLException {

	        Connection con = DBConnection.getConnection();

	        /* ---------- STEP 1: Check if seller has added any products ---------- */
	        String productCheckSql =
	            "SELECT COUNT(*) FROM products WHERE seller_id = ?";

	        PreparedStatement ps1 = con.prepareStatement(productCheckSql);
	        ps1.setInt(1, sellerId);

	        ResultSet rs1 = ps1.executeQuery();
	        rs1.next();
	        int productCount = rs1.getInt(1);

	        rs1.close();
	        ps1.close();

	        if (productCount == 0) {
	            System.out.println("You have not added any products yet.");
	            con.close();
	            return;
	        }

	      
	        String sql =
	            "SELECT o.order_id, o.order_date, p.name, oi.quantity, oi.price " +
	            "FROM orders o " +
	            "JOIN order_items oi ON o.order_id = oi.order_id " +
	            "JOIN products p ON oi.product_id = p.product_id " +
	            "WHERE p.seller_id = ? " +
	            "ORDER BY o.order_id";

	        PreparedStatement ps2 = con.prepareStatement(sql);
	        ps2.setInt(1, sellerId);

	        ResultSet rs2 = ps2.executeQuery();

	        boolean foundOrders = false;

	        System.out.println("OrderID | Date | Product | Qty | Price");

	        while (rs2.next()) {
	            foundOrders = true;
	            System.out.println(
	                rs2.getInt("order_id") + " | " +
	                rs2.getDate("order_date") + " | " +
	                rs2.getString("name") + " | " +
	                rs2.getInt("quantity") + " | " +
	                rs2.getDouble("price")
	            );
	        }

	        if (!foundOrders) {
	            System.out.println("Your products have not received any orders yet.");
	        }

	        rs2.close();
	        ps2.close();
	        con.close();
	    }

	   


}