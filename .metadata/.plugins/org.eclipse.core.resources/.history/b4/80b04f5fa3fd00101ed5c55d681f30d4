package com.revshop.service;
import java.sql.ResultSet;
import com.revshop.dao.UserDAO;
import com.revshop.util.DBConnection; 
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;
public class UserService {

    UserDAO userDAO = new UserDAO();

    public boolean register(String name, String email, String password, String role ) {
        return userDAO.register(name, email, password, role);
    }


    public boolean changePassword(String email, String newPwd) {
        return userDAO.changePassword(email, newPwd);
    }
        public String login(String email, String password) {
            return userDAO.loginAndGetRole(email, password);
        }
     

            public int loginAndGetUserId(String email, String password) {
                int userId = -1;
                Connection con = null;
                PreparedStatement ps = null;
                ResultSet rs = null;

                try {
                    con = DBConnection.getConnection();
                    ps = con.prepareStatement("SELECT user_id FROM users WHERE email=? AND password=?");
                    ps.setString(1, email);
                    ps.setString(2, password);
                    rs = ps.executeQuery();
                    if (rs.next()) {
                        userId = rs.getInt("user_id");
                    }
                } catch (SQLException e) {
                    e.printStackTrace();
                } finally {
                    try { if (rs != null) rs.close(); } catch (SQLException e) { e.printStackTrace(); }
                    try { if (ps != null) ps.close(); } catch (SQLException e) { e.printStackTrace(); }
                    try { if (con != null) con.close(); } catch (SQLException e) { e.printStackTrace(); }
                }

                return userId;
            }

            public String loginAndGetRole(String email, String password) {
                String role = null;
                Connection con = null;
                PreparedStatement ps = null;
                ResultSet rs = null;

                try {
                    con = DBConnection.getConnection();
                    ps = con.prepareStatement("SELECT role FROM users WHERE email=? AND password=?");
                    ps.setString(1, email);
                    ps.setString(2, password);
                    rs = ps.executeQuery();
                    if (rs.next()) {
                        role = rs.getString("role");
                    }
                } catch (SQLException e) {
                    e.printStackTrace();
                } finally {
                    try { if (rs != null) rs.close(); } catch (SQLException e) { e.printStackTrace(); }
                    try { if (ps != null) ps.close(); } catch (SQLException e) { e.printStackTrace(); }
                    try { if (con != null) con.close(); } catch (SQLException e) { e.printStackTrace(); }
                }

                return role;
            }
        }


       

        
//        public int loginAndGetUserId(String email, String password) {
//            try {
//                ResultSet rs = userDAO.loginAndGetUser(email, password);
//                if (rs != null && rs.next()) {
//                    return rs.getInt("user_id");
//                }
//            } catch (Exception e) {
//                e.printStackTrace();
//            }
//            return -1;
//        }
//
//        public String loginAndGetRole(String email, String password) {
//            try {
//                ResultSet rs = userDAO.loginAndGetUser(email, password);
//                if (rs != null && rs.next()) {
//                    return rs.getString("role");
//                }
//            } catch (Exception e) {
//                e.printStackTrace();
//            }
//            return null;
//        }

    

